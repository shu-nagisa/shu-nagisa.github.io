<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ゲストページ</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.css"/>
  <link rel="stylesheet" href="guest.css" />
  <style>
    /* 花火アニメーション */
    @keyframes fireworks {
      0% {
        transform: scale(1);
        opacity: 1;
      }
      50% {
        transform: scale(3);
        opacity: 0.7;
      }
      100% {
        transform: scale(1);
        opacity: 0;
      }
    }

    .fireworks-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 9999;
      background: transparent;
    }

    .fireworks {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 300px;
      height: 300px;
      border-radius: 50%;
      background: radial-gradient(circle, #ff4d4d, #ffcc00);
      animation: fireworks 3s infinite;
    }
  </style>
</head>
<body>
  <!-- 花火アニメーション -->
  <div class="fireworks-container" id="fireworks"></div>

  <main class="container">
    <h1 id="guestName"></h1>
    <p id="guestMessage"></p>

    <div class="swiper">
      <div class="swiper-wrapper"></div>
      <div class="swiper-pagination"></div>
    </div>

    <div class="section-title">イラスト画像ダウンロード</div>
    <div class="section-description">
      席次表に掲載のイラスト画像をダウンロードいただけます<br>
      画像を長押しし「画像を保存」を選択してください
    </div>

    <div class="thumbnails"></div>
  </main>

  <footer>
    <div class="main-title">S＆N WEDDING PARTY</div>
    <div class="sub-info">27 June, 2025</div>
    <div class="sub-info">Seragaki Island Chapel</div>
    <div class="sub-info">Hyatt Regency Seragaki Island, Okinawa</div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.js"></script>
  <script src="guest.js"></script>
  <script>
    // 花火アニメーションの表示
    function createFirework() {
      const fireworksContainer = document.getElementById('fireworks');
      
      const firework = document.createElement('div');
      firework.classList.add('fireworks');

      // ランダムな位置と時間を設定
      firework.style.top = `${Math.random() * 100}vh`;
      firework.style.left = `${Math.random() * 100}vw`;
      firework.style.animationDuration = `${Math.random() * 2 + 3}s`; // ランダムなアニメーション時間

      fireworksContainer.appendChild(firework);

      // 一定時間後に花火を削除
      setTimeout(() => {
        firework.remove();
      }, 5000); // 5秒後に花火を削除
    }

    // ページ読み込み時に花火を作成
    document.addEventListener('DOMContentLoaded', () => {
      setInterval(createFirework, 1000); // 毎秒新しい花火を作成
    });

    const params = new URLSearchParams(window.location.search);
    const dob = params.get('dob');

    function showGuestNotFound() {
      document.getElementById('guestName').textContent = 'ゲスト情報が見つかりません';
      document.getElementById('guestMessage').textContent = 'ページが表示できませんでした。URLをご確認ください。';
    }

    if (!dob) {
      showGuestNotFound();
      throw new Error('dob パラメータが指定されていません');
    }

    fetch('guests.json')
      .then(response => response.json())
      .then(data => {
        const guest = data.find(item => item.dob === dob);
        if (!guest) {
          showGuestNotFound();
          return;
        }

        document.getElementById('guestName').textContent = guest.name + ' へ';
        document.getElementById('guestMessage').textContent = guest.message;

        // スライダー画像
        if (Array.isArray(guest.memories)) {
          const wrapper = document.querySelector('.swiper-wrapper');
          guest.memories.forEach(id => {
            const slide = document.createElement('div');
            slide.className = 'swiper-slide';

            const img = document.createElement('img');
            img.src = `memories/${id}.jpg`;
            img.alt = `Memory ${id}`;
            img.onerror = () => {
              slide.remove();
            };

            slide.appendChild(img);
            wrapper.appendChild(slide);
          });

          new Swiper('.swiper', {
            loop: true,
            slidesPerView: 1,
            centeredSlides: true,
            spaceBetween: 60,
            pagination: {
              el: '.swiper-pagination',
              clickable: true
            },
            autoplay: {
              delay: 3000,
              disableOnInteraction: false
            }
          });
        }

        // イラスト画像
        if (Array.isArray(guest.portraits)) {
          const container = document.querySelector('.thumbnails');
          guest.portraits.forEach((path, index) => {
            const link = document.createElement('a');
            link.href = path;
            link.download = path.split('/').pop();
            link.setAttribute('aria-label', `イラスト${index + 1}をダウンロード`);

            const img = document.createElement('img');
            img.src = path;
            img.alt = `イラスト${index + 1}`;
            img.onerror = () => {
              link.remove();
            };

            link.appendChild(img);
            container.appendChild(link);
          });
        }
      })
      .catch(error => {
        console.error('ゲスト情報の読み込みに失敗しました:', error);
        showGuestNotFound();
      });
  </script>
</body>
</html>
